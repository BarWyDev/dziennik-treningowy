import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as u}from"./index.TcFrwHGi.js";import{B as g}from"./Button.DG6KPLDP.js";import{o as S,s as b,n as C,u as M,a as G,L as p}from"./Label.CntfKGud.js";import{I as f}from"./Input.hTVRzoe8.js";import{A as L}from"./Alert.D-DBx2Lh.js";import{D as T}from"./Dialog.0K2iIL7s.js";function A(s){return new Date(s).toLocaleDateString("pl-PL",{day:"numeric",month:"short",year:"numeric"})}function D(s,r){return!r||r===0?0:Math.min(100,Math.round((s||0)/r*100))}function N({goal:s,onUpdate:r,onEdit:l}){const[m,c]=u.useState(!1),d=D(s.currentValue,s.targetValue),n=s.status==="achieved",o=s.targetValue&&s.targetValue>0,i=async()=>{c(!0);try{(await fetch(`/api/goals/${s.id}/achieve`,{method:"PATCH"})).ok&&r()}catch{console.error("Error achieving goal")}finally{c(!1)}},j=async()=>{c(!0);try{(await fetch(`/api/goals/${s.id}/archive`,{method:"PATCH"})).ok&&r()}catch{console.error("Error archiving goal")}finally{c(!1)}},a=async()=>{if(confirm("Czy na pewno chcesz usunąć ten cel?")){c(!0);try{(await fetch(`/api/goals/${s.id}`,{method:"DELETE"})).ok&&r()}catch{console.error("Error deleting goal")}finally{c(!1)}}};return e.jsx("div",{className:`bg-white dark:bg-[#161b22] rounded-xl shadow-sm border p-5 ${n?"border-success-200 dark:border-success-700 bg-success-50/50 dark:bg-success-900/20":"border-gray-200 dark:border-gray-800"}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n&&e.jsx("svg",{className:"w-5 h-5 lg:w-6 lg:h-6 text-success-500 dark:text-success-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("h3",{className:`text-base lg:text-lg font-semibold ${n?"text-success-800 dark:text-success-300":"text-gray-900 dark:text-gray-100"}`,children:s.title})]}),s.description&&e.jsx("p",{className:"text-sm lg:text-base text-gray-600 dark:text-gray-400 mt-1",children:s.description}),o&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm lg:text-base mb-1",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[s.currentValue||0," / ",s.targetValue," ",s.unit]}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:[d,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${n?"bg-success-500 dark:bg-success-400":"bg-primary-600 dark:bg-primary-500"}`,style:{width:`${d}%`}})})]}),s.deadline&&e.jsxs("p",{className:"text-xs lg:text-sm text-gray-500 dark:text-gray-400 mt-2",children:["Termin: ",A(s.deadline)]}),s.achievedAt&&e.jsxs("p",{className:"text-xs lg:text-sm text-success-600 dark:text-success-400 mt-2",children:["Osiągnięto: ",A(s.achievedAt)]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[!n&&e.jsx(g,{variant:"ghost",size:"sm",onClick:i,isLoading:m,title:"Oznacz jako osiągnięty",children:e.jsx("svg",{className:"w-4 h-4 text-success-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>l(s),title:"Edytuj cel",children:e.jsx("svg",{className:"w-4 h-4 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsx(g,{variant:"ghost",size:"sm",onClick:j,isLoading:m,title:"Zarchiwizuj",children:e.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})})}),e.jsx(g,{variant:"ghost",size:"sm",onClick:a,isLoading:m,title:"Usuń",children:e.jsx("svg",{className:"w-4 h-4 text-error-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})})}const E=S({title:b().min(3,"Tytuł musi mieć co najmniej 3 znaki").max(100,"Tytuł może mieć maksymalnie 100 znaków"),description:b().max(500,"Opis może mieć maksymalnie 500 znaków").optional(),targetValue:C().min(1,"Wartość docelowa musi być większa od 0").optional(),unit:b().max(20,"Jednostka może mieć maksymalnie 20 znaków").optional(),deadline:b().optional()}),W=E.partial().extend({currentValue:C().min(0).optional()});function B({goal:s,onSuccess:r,onCancel:l}){const[m,c]=u.useState(null),[d,n]=u.useState(!1),o=!!s,{register:i,handleSubmit:j,formState:{errors:a}}=M({resolver:G(o?W:E),defaultValues:s?{title:s.title,description:s.description||"",targetValue:s.targetValue||void 0,currentValue:s.currentValue||0,unit:s.unit||"",deadline:s.deadline||""}:void 0}),h=async y=>{n(!0),c(null);try{const x=o?`/api/goals/${s.id}`:"/api/goals",v=await fetch(x,{method:o?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)});if(!v.ok){const k=await v.json();throw new Error(k.error||"Wystąpił błąd")}r()}catch(x){c(x instanceof Error?x.message:"Wystąpił błąd")}finally{n(!1)}};return e.jsxs("form",{onSubmit:j(h),className:"space-y-4",children:[m&&e.jsx(L,{variant:"error",children:m}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"title",required:!0,children:"Tytuł celu"}),e.jsx(f,{id:"title",placeholder:"np. Przebiec maraton",error:a.title?.message,...i("title")})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"description",children:"Opis (opcjonalnie)"}),e.jsx("textarea",{id:"description",rows:2,className:"block w-full rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 px-3 py-2 text-sm lg:text-base placeholder-gray-400 dark:placeholder-gray-500 focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500",placeholder:"Krótki opis celu...",...i("description")}),a.description&&e.jsx("p",{className:"mt-1 text-sm lg:text-base text-error-600 dark:text-error-400",children:a.description.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{htmlFor:"targetValue",children:"Wartość docelowa"}),e.jsx(f,{id:"targetValue",type:"number",min:"1",placeholder:"np. 42",error:a.targetValue?.message,...i("targetValue",{valueAsNumber:!0})})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"unit",children:"Jednostka"}),e.jsx(f,{id:"unit",placeholder:"np. km",error:a.unit?.message,...i("unit")})]})]}),o&&e.jsxs("div",{children:[e.jsx(p,{htmlFor:"currentValue",children:"Aktualny postęp"}),e.jsx(f,{id:"currentValue",type:"number",min:"0",placeholder:"np. 25",error:a.currentValue?.message,...i("currentValue",{valueAsNumber:!0})}),e.jsx("p",{className:"mt-1 text-xs lg:text-sm text-gray-500 dark:text-gray-400",children:"Wprowadź ile już osiągnąłeś z wartości docelowej"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"deadline",children:"Termin (opcjonalnie)"}),e.jsx(f,{id:"deadline",type:"date",error:a.deadline?.message,...i("deadline")})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(g,{type:"submit",isLoading:d,className:"flex-1",children:o?"Zapisz zmiany":"Dodaj cel"}),e.jsx(g,{type:"button",variant:"secondary",onClick:l,children:"Anuluj"})]})]})}function F({activeCount:s,maxGoals:r}){const l=r-s;return l>2?null:l===0?e.jsxs(L,{variant:"warning",title:"Limit celów osiągnięty",children:["Masz maksymalną liczbę aktywnych celów (",r,"). Oznacz cel jako osiągnięty lub zarchiwizuj, aby dodać nowy."]}):e.jsxs(L,{variant:"info",children:["Pozostało ",l," ",l===1?"miejsce":"miejsca"," na aktywne cele (maks. ",r,")."]})}const z=5;function R(){const[s,r]=u.useState([]),[l,m]=u.useState(!0),[c,d]=u.useState(!1),[n,o]=u.useState(null),[i,j]=u.useState(!1),a=async()=>{m(!0);try{const t=await fetch("/api/goals");if(t.ok){const w=await t.json();r(w)}}catch{console.error("Error fetching goals")}finally{m(!1)}};u.useEffect(()=>{a()},[]);const h=s.filter(t=>!t.isArchived&&t.status==="active"),y=s.filter(t=>!t.isArchived&&t.status==="achieved"),x=s.filter(t=>t.isArchived),V=h.length<z,v=()=>{d(!1),o(null),a()},k=t=>{o(t)};return l?e.jsx("div",{className:"space-y-4",children:[...Array(2)].map((t,w)=>e.jsxs("div",{className:"bg-white dark:bg-[#161b22] rounded-xl shadow-sm border border-gray-200 dark:border-gray-800 p-5 animate-pulse",children:[e.jsx("div",{className:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-1/3 mb-3"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3"})]},w))}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(F,{activeCount:h.length,maxGoals:z}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-lg lg:text-xl font-semibold text-gray-900 dark:text-gray-100",children:["Aktywne cele (",h.length,"/",z,")"]}),V&&e.jsxs(g,{size:"sm",onClick:()=>d(!0),children:[e.jsx("svg",{className:"w-4 h-4 lg:w-5 lg:h-5 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Dodaj cel"]})]}),h.length===0?e.jsxs("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-900 rounded-xl border border-dashed border-gray-300 dark:border-gray-700",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 lg:h-14 lg:w-14 text-gray-400 dark:text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})}),e.jsx("p",{className:"mt-2 text-sm lg:text-base text-gray-600 dark:text-gray-400",children:"Brak aktywnych celów"}),e.jsx(g,{size:"sm",className:"mt-4",onClick:()=>d(!0),children:"Dodaj pierwszy cel"})]}):e.jsx("div",{className:"space-y-3",children:h.map(t=>e.jsx(N,{goal:t,onUpdate:a,onEdit:k},t.id))})]}),y.length>0&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg lg:text-xl font-semibold text-gray-900 dark:text-gray-100 mb-4",children:["Osiągnięte cele (",y.length,")"]}),e.jsx("div",{className:"space-y-3",children:y.map(t=>e.jsx(N,{goal:t,onUpdate:a,onEdit:k},t.id))})]}),x.length>0&&e.jsxs("div",{children:[e.jsxs("button",{type:"button",className:"flex items-center gap-2 text-sm lg:text-base text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",onClick:()=>j(!i),children:[e.jsx("svg",{className:`w-4 h-4 lg:w-5 lg:h-5 transition-transform ${i?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})}),i?"Ukryj":"Pokaż"," zarchiwizowane (",x.length,")"]}),i&&e.jsx("div",{className:"mt-4 space-y-3 opacity-60",children:x.map(t=>e.jsx(N,{goal:t,onUpdate:a,onEdit:k},t.id))})]}),e.jsx(T,{isOpen:c||!!n,onClose:()=>{d(!1),o(null)},title:n?"Edytuj cel":"Dodaj nowy cel",children:e.jsx(B,{goal:n||void 0,onSuccess:v,onCancel:()=>{d(!1),o(null)}})})]})}export{R as GoalList};
