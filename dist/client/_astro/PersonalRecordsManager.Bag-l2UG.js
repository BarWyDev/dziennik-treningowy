import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.TcFrwHGi.js";import{o as O,s as y,u as L,a as B,L as m}from"./Label.CntfKGud.js";import{B as k}from"./Button.DG6KPLDP.js";import{I as f}from"./Input.hTVRzoe8.js";import{A as C}from"./Alert.D-DBx2Lh.js";import{S}from"./Select.DKs09Ukh.js";import{D as F}from"./Dialog.0K2iIL7s.js";const z=O({activityName:y().min(1,"Nazwa aktywności jest wymagana").max(100,"Nazwa aktywności nie może być dłuższa niż 100 znaków"),result:y().min(1,"Wynik jest wymagany").max(50,"Wynik nie może być dłuższy niż 50 znaków").refine(t=>/^\d+([.,]\d+)?$/.test(t),"Wynik musi być liczbą (np. 100 lub 100,5)"),unit:y().min(1,"Jednostka jest wymagana").max(20,"Jednostka nie może być dłuższa niż 20 znaków"),date:y().min(1,"Data jest wymagana"),notes:y().max(500,"Notatki nie mogą być dłuższe niż 500 znaków").optional()});z.partial();function D({record:t,onSuccess:a}){const[i,n]=r.useState(null),[d,o]=r.useState(!1),l=!!t,{register:x,handleSubmit:h,formState:{errors:c},reset:w}=L({resolver:B(z),defaultValues:{activityName:t?.activityName||"",result:t?.result||"",unit:t?.unit||"",date:t?.date||new Date().toISOString().split("T")[0],notes:t?.notes||""}}),u=async p=>{o(!0),n(null);try{const g=l?`/api/personal-records/${t.id}`:"/api/personal-records",j=await fetch(g,{method:l?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(!j.ok){const N=await j.json();throw new Error(N.error||"Wystąpił błąd")}l||w(),a&&a()}catch(g){n(g instanceof Error?g.message:"Wystąpił nieoczekiwany błąd")}finally{o(!1)}};return e.jsxs("form",{onSubmit:h(u),className:"space-y-6",children:[i&&e.jsx(C,{variant:"error",title:"Błąd",children:i}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"activityName",required:!0,children:"Nazwa aktywności"}),e.jsx(f,{id:"activityName",type:"text",placeholder:"np. Wyciskanie sztangi, Sprint 100m",error:c.activityName?.message,...x("activityName")})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"result",required:!0,children:"Wynik"}),e.jsx(f,{id:"result",type:"text",placeholder:"np. 100 lub 100,5",error:c.result?.message,...x("result")})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"unit",required:!0,children:"Jednostka"}),e.jsx(f,{id:"unit",type:"text",placeholder:"np. kg, km, min, sek",error:c.unit?.message,...x("unit")})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"date",required:!0,children:"Data"}),e.jsx(f,{id:"date",type:"date",error:c.date?.message,...x("date")})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"notes",children:"Notatki"}),e.jsx("textarea",{id:"notes",rows:3,className:"w-full px-3 py-2 text-sm lg:text-base border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Dodatkowe informacje...",...x("notes")}),c.notes&&e.jsx("p",{className:"mt-1 text-sm lg:text-base text-error-600 dark:text-error-400",children:c.notes.message})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{type:"submit",disabled:d,children:d?"Zapisywanie...":l?"Zapisz zmiany":"Dodaj rekord"}),l&&a&&e.jsx(k,{type:"button",variant:"secondary",onClick:a,children:"Anuluj"})]})]})}function P({record:t,onEdit:a,onDelete:i}){const[n,d]=r.useState(!1),o=async()=>{if(confirm("Czy na pewno chcesz usunąć ten rekord?")){d(!0);try{await i(t.id)}catch{d(!1)}}},l=new Date(t.date).toLocaleDateString("pl-PL",{day:"numeric",month:"long",year:"numeric"});return e.jsxs("div",{className:"bg-white dark:bg-[#161b22] border border-gray-200 dark:border-gray-800 rounded-lg p-6 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg lg:text-xl font-semibold text-gray-900 dark:text-gray-100",children:t.activityName}),e.jsx("p",{className:"text-sm lg:text-base text-gray-500 dark:text-gray-400 mt-1",children:l})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-2xl lg:text-3xl font-bold text-blue-600 dark:text-blue-400",children:[t.result," ",e.jsx("span",{className:"text-sm lg:text-base font-normal text-gray-600 dark:text-gray-400",children:t.unit})]})})]}),t.notes&&e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"text-sm lg:text-base text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-900 p-3 rounded-md",children:t.notes})}),e.jsxs("div",{className:"flex gap-2 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsx(k,{variant:"secondary",size:"sm",onClick:()=>a(t),children:"Edytuj"}),e.jsx(k,{variant:"danger",size:"sm",onClick:o,disabled:n,children:n?"Usuwanie...":"Usuń"})]})]})}function W(){const[t,a]=r.useState([]),[i,n]=r.useState(!0),[d,o]=r.useState("date"),[l,x]=r.useState("desc"),[h,c]=r.useState(null),[w,u]=r.useState(!1),p=async()=>{n(!0);try{const s=await fetch(`/api/personal-records?sortBy=${d}&sortOrder=${l}`);if(s.ok){const b=await s.json();a(b)}}catch(s){console.error("Error fetching records:",s)}finally{n(!1)}};r.useEffect(()=>{p()},[d,l]);const g=async s=>{try{(await fetch(`/api/personal-records/${s}`,{method:"DELETE"})).ok&&a(t.filter(R=>R.id!==s))}catch(b){console.error("Error deleting record:",b)}},v=s=>{c(s),u(!0)},j=()=>{u(!1),c(null),p()};if(i)return e.jsx("div",{className:"text-center py-8 text-gray-600 dark:text-gray-400 text-base lg:text-lg",children:"Ładowanie..."});if(t.length===0)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-lg lg:text-xl",children:"Nie masz jeszcze żadnych rekordów osobistych."}),e.jsx("p",{className:"text-gray-400 dark:text-gray-500 mt-2 text-base lg:text-lg",children:"Dodaj swój pierwszy rekord używając formularza powyżej!"})]});const N=[{value:"date",label:"Data"},{value:"activityName",label:"Nazwa aktywności"},{value:"result",label:"Wynik"},{value:"createdAt",label:"Data dodania"}],E=[{value:"desc",label:"Malejąco"},{value:"asc",label:"Rosnąco"}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{htmlFor:"sortBy",children:"Sortuj według"}),e.jsx(S,{id:"sortBy",options:N,value:d,onChange:s=>o(s.target.value)})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{htmlFor:"sortOrder",children:"Kolejność"}),e.jsx(S,{id:"sortOrder",options:E,value:l,onChange:s=>x(s.target.value)})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(s=>e.jsx(P,{record:s,onEdit:v,onDelete:g},s.id))}),e.jsx(F,{isOpen:w,onClose:()=>{u(!1),c(null)},title:"Edytuj rekord",children:h&&e.jsx(D,{record:h,onSuccess:j})})]})}function I(){const[t,a]=r.useState(null),[i,n]=r.useState(!0);return r.useEffect(()=>{(async()=>{try{const o=await fetch("/api/personal-records/stats");if(o.ok){const l=await o.json();a(l)}}catch(o){console.error("Error fetching stats:",o)}finally{n(!1)}})()},[]),i?e.jsx("div",{className:"text-center py-4 text-gray-600 dark:text-gray-400 text-base lg:text-lg",children:"Ładowanie statystyk..."}):t?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 dark:from-blue-600 dark:to-blue-700 text-white rounded-lg p-6 shadow-md",children:[e.jsx("p",{className:"text-blue-100 dark:text-blue-200 text-sm lg:text-base font-medium mb-2",children:"Łączna liczba rekordów"}),e.jsx("p",{className:"text-4xl lg:text-5xl font-bold",children:t.totalCount})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500 to-green-600 dark:from-green-600 dark:to-green-700 text-white rounded-lg p-6 shadow-md",children:[e.jsx("p",{className:"text-green-100 dark:text-green-200 text-sm lg:text-base font-medium mb-2",children:"Ostatnio dodany rekord"}),t.lastRecord?e.jsxs("div",{children:[e.jsx("p",{className:"text-xl lg:text-2xl font-bold",children:t.lastRecord.activityName}),e.jsxs("p",{className:"text-green-100 dark:text-green-200 text-sm lg:text-base mt-1",children:[t.lastRecord.result," ",t.lastRecord.unit," • ",new Date(t.lastRecord.date).toLocaleDateString("pl-PL")]})]}):e.jsx("p",{className:"text-lg lg:text-xl",children:"Brak rekordów"})]})]}):null}function K(){const[t,a]=r.useState(0),i=()=>{a(n=>n+1)};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl lg:text-4xl font-bold text-gray-900 dark:text-gray-100 mb-2",children:"Rekordy osobiste"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-base lg:text-lg",children:"Śledź swoje najlepsze osiągnięcia i obserwuj postępy"})]}),e.jsx(I,{},`stats-${t}`),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white dark:bg-[#161b22] rounded-lg shadow-md border border-gray-200 dark:border-gray-800 p-6 sticky top-4",children:[e.jsx("h2",{className:"text-xl lg:text-2xl font-semibold text-gray-900 dark:text-gray-100 mb-6",children:"Dodaj nowy rekord"}),e.jsx(D,{onSuccess:i})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white dark:bg-[#161b22] rounded-lg shadow-md border border-gray-200 dark:border-gray-800 p-6",children:[e.jsx("h2",{className:"text-xl lg:text-2xl font-semibold text-gray-900 dark:text-gray-100 mb-6",children:"Wszystkie rekordy"}),e.jsx(W,{},`list-${t}`)]})})]})]})}export{K as PersonalRecordsManager};
